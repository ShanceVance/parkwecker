<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>ParkWecker – Parkschein-Timer</title>
<meta name="theme-color" content="#0f172a"/>
<meta name="color-scheme" content="dark light">

<!-- PWA Meta Tags -->
<link rel="manifest" href="./manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ParkWecker">
<link rel="apple-touch-icon" href="./icon-192.png">
<link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">

<style>
/* ======= Design-System (Glas/Neo, Premium) ======= */
:root{
  --bg1:#0f172a; --bg2:#111827;
  --accent1:#7c3aed; --accent2:#06b6d4; --accent3:#22c55e;
  --warn:#f59e0b; --danger:#ef4444;
  --surface:rgba(255,255,255,.06); --surface-strong:rgba(255,255,255,.12);
  --text:#e5e7eb; --muted:#cbd5e1;
  --shadow:0 18px 45px rgba(0,0,0,.45);
  --glass: blur(14px) saturate(120%);
  --r:18px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Arial;
  color:var(--text);
  background:
    radial-gradient(1200px 800px at 80% -10%, rgba(124,58,237,.25), transparent 60%),
    radial-gradient(1000px 700px at -10% 20%, rgba(6,182,212,.22), transparent 60%),
    linear-gradient(180deg, var(--bg1), var(--bg2));
  -webkit-tap-highlight-color: transparent;
  overflow-x:hidden;
}

.app{
  min-height:100%;
  display:grid; grid-template-rows:auto 1fr; gap:12px;
  padding:max(10px,env(safe-area-inset-top)) max(10px,env(safe-area-inset-right))
          calc(18px + env(safe-area-inset-bottom)) max(10px,env(safe-area-inset-left));
}

/* Header */
header{display:flex; align-items:center; justify-content:space-between;}
.brand{display:flex; gap:10px; align-items:center; font-weight:800; letter-spacing:.2px; cursor:pointer}
h1.brand-name{font-size:18px; margin:0}

/* App-Icon (CSS/SVG) */
.pw-icon{
  --size: 30px; --radius: 30%;
  width:var(--size); height:var(--size);
  border-radius:var(--radius);
  position:relative; overflow:hidden; display:grid; place-items:center;
  background:
    radial-gradient(120% 100% at 80% 10%, rgba(255,255,255,.18), transparent 55%),
    linear-gradient(135deg, #1e40af 0%, #06b6d4 100%);
  box-shadow: inset 0 0 10px rgba(255,255,255,.12);
}
.pw-icon::after{content:""; position:absolute; inset:0; border-radius:inherit; box-shadow: inset 0 0 0 1px rgba(255,255,255,.14);}
.pw-symbol{ width:70%; height:70%; filter: drop-shadow(0 2px 6px rgba(0,0,0,.25)); }

/* Icon buttons */
.icon-btn{
  border:none; background:var(--surface); border:1px solid rgba(255,255,255,.08);
  width:44px; height:44px; border-radius:14px; display:grid; place-items:center;
  box-shadow:var(--shadow); backdrop-filter: var(--glass);
  transition: transform .12s ease, box-shadow .25s ease, background .25s ease;
}
.icon-btn:hover{ transform: translateY(-1px); box-shadow:0 16px 40px rgba(0,0,0,.5); background:var(--surface-strong) }

/* Screens */
.screen{display:none; animation:fade .24s ease-out}
.screen.active{display:block}
@keyframes fade{from{opacity:.0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}

/* ===== EIN großer Container mit Trennern ===== */
.card{
  background: var(--surface); border:1px solid rgba(255,255,255,.08);
  border-radius: var(--r); box-shadow: var(--shadow);
  backdrop-filter: var(--glass); -webkit-backdrop-filter: var(--glass);
  padding:12px;
}
#screenStart .main-container{ display:block; }
.section{ padding:10px 4px; }
.section h2{margin:0 0 8px; font-size:17px}
.section-divider{height:1px; background:rgba(255,255,255,.14); margin:6px 0;}

/* Buttons */
.btn{
  border:none; border-radius:16px; padding:16px; min-height:60px; font-weight:800;
  color:#fff; background:linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
  border:1px solid rgba(255,255,255,.12); box-shadow: var(--shadow);
  transition: transform .08s ease, filter .25s ease, background .25s ease;
  width:100%;
  display:flex; align-items:center; justify-content:center;
}
.btn:active{transform:scale(.98)}
.btn:hover{filter:brightness(1.05)}
.btn.primary{background:linear-gradient(135deg, var(--accent2), var(--accent1));}
.btn.flat{background:var(--surface); border:1px solid rgba(255,255,255,.08)}
.btn.warn{background:linear-gradient(135deg, var(--warn), #fbbf24); color:#111}
.btn.danger{background:linear-gradient(135deg, var(--danger), #f87171);}
.btn.small{min-height:56px; padding:14px; border-radius:14px}

/* Start-Buttons */
.start-grid{display:grid; grid-template-columns:1fr; gap:10px; margin-top:2px}
@media(min-width:420px){ .start-grid{grid-template-columns:repeat(3,1fr)} }

/* START Button – breit, uppercase, zentriert */
#btnManualStart{
  text-transform:uppercase;
  font-size:18px; font-weight:800; letter-spacing:.4px;
  align-self:stretch;
}

/* ====== Scroll-Picker ====== */
.wheels{display:grid; grid-template-columns:1fr 1fr; gap:10px}
.wheel{
  position:relative; height:160px; border-radius:14px; overflow:hidden;
  background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.12);
  box-shadow: inset 0 6px 16px rgba(0,0,0,.25), inset 0 -6px 16px rgba(0,0,0,.25);
}
.wheel .viewport{
  height:100%; overflow-y:auto; scroll-snap-type:y mandatory;
  scrollbar-width:none; -ms-overflow-style:none;
  overscroll-behavior-y: contain;
}
.wheel .viewport::-webkit-scrollbar{display:none}

.item{
  height:48px;
  display:flex; align-items:center; justify-content:center;
  font-size:20px; color:var(--muted);
  scroll-snap-align:center;
  transition: transform .12s ease, color .12s ease;
  font-variant-numeric: tabular-nums;
  line-height:1; user-select:none;
}
.item.sel{ color:#fff; transform:scale(1.16); font-weight:800; }

/* Center-Highlight-Linien */
.wheel::before, .wheel::after{
  content:""; position:absolute; left:8px; right:8px; height:0; border-top:1px dashed rgba(255,255,255,.22);
}
.wheel::before{ top: calc(50% - 24px); }
.wheel::after{ top: calc(50% + 24px); }

/* Single wheel (Reminder) */
.wheel.single{ grid-column:1/-1; }

/* Timer ring */
.timer-wrap{display:grid; gap:12px}
.ring{ position:relative; width:100%; max-width:520px; margin:0 auto; aspect-ratio:1/1; display:grid; place-items:center; filter: drop-shadow(0 18px 45px rgba(0,0,0,.45)); }
.ring svg{width:100%; height:100%}
.ring .shadow-glow{ position:absolute; inset: -10% -10% -10% -10%; background: radial-gradient(closest-side, rgba(124,58,237,.25), transparent 70%); z-index:0; filter: blur(20px); }
.ring .time{
  position:absolute; width:100%; text-align:center; z-index:2; font-variant-numeric: tabular-nums; letter-spacing:.6px;
  top:50%; left:50%; transform:translate(-50%,-50%);
}
.time .big{font-size:44px; font-weight:800}

/* Photo */
.photo-wrap{
  position:relative; border-radius:18px; overflow:hidden; background:#0b0b0b; aspect-ratio:16/9; display:grid; place-items:center;
  border:1px solid rgba(255,255,255,.12); box-shadow: var(--shadow); backdrop-filter:var(--glass); margin-top:4px;
}
.photo-wrap img,.photo-wrap video,.photo-wrap canvas{width:100%; height:100%; object-fit:cover}
.tap-overlay{ position:absolute; inset:auto 0 0 0; background:linear-gradient(180deg, transparent, rgba(0,0,0,.55)); color:#fff; padding:8px 12px; font-size:13px; text-align:center; opacity:0; transition:opacity .25s ease; pointer-events:none; z-index:2 }
.photo-wrap:hover .tap-overlay{opacity:1}
.chip{ background:rgba(0,0,0,.5); color:#fff; border:none; border-radius:12px; padding:10px 12px; min-height:44px; min-width:44px; font-size:15px; border:1px solid rgba(255,255,255,.14); backdrop-filter: blur(8px); }

/* Overlay (Prompt / Alarm / End / Settings) */
.overlay{position:fixed; inset:0; background:rgba(10,10,10,.6); display:none; align-items:center; justify-content:center; padding:14px; z-index:20}
.overlay.show{display:flex}
.modal{
  width:100%; max-width:520px; background:var(--surface); border-radius:20px; box-shadow: var(--shadow);
  border:1px solid rgba(255,255,255,.12); padding:14px; text-align:center; backdrop-filter:var(--glass)
}
.modal h3{margin:6px 0 4px}
.modal p{margin:0 0 10px; color:var(--muted)}

/* Settings – Alarmton Auswahl */
.settings-group{ text-align:left; display:grid; gap:10px; margin:10px 0 }
.alarm-row{ display:grid; grid-template-columns:1fr auto auto; gap:10px; align-items:center; }
.badge{ font-size:12px; color:#111; background:#fff; border-radius:999px; padding:4px 8px; display:none; }
.badge.show{ display:inline-block; }

/* History */
.history{display:grid; gap:8px}
.row{
  display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center; padding:8px;
  border-radius:12px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.06); backdrop-filter:var(--glass)
}
.thumb{width:56px; height:40px; object-fit:cover; border-radius:8px; background:#111; border:1px solid rgba(255,255,255,.1)}
.meta{font-size:13px; color:#e5e7eb80}
.pill{background:rgba(255,255,255,.06); padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.1); font-size:12px; color:#e5e7eb9c}

/* Toast */
#toast{position:fixed; top:14px; left:50%; transform:translateX(-50%); display:none; padding:8px 12px; border-radius:999px}

/* ======= Responsive Tweaks ======= */
@media (max-height: 700px){
  .wheel{height:140px}
  .item{font-size:19px}
  .btn.small{min-height:52px}
  .start-grid{gap:8px}
}
@media (max-height: 600px){
  .wheel{height:128px}
  .item{font-size:18px}
}
@media (max-width: 360px){
  .item{font-size:18px}
  .btn{min-height:56px}
  .wheels{gap:8px}
}
</style>
</head>
<body>
<div class="app" id="app">
  <!-- Header -->
  <header>
    <div class="brand" id="brandHome" title="Zur Startseite">
      <div class="pw-icon" aria-hidden="true">
        <svg viewBox="0 0 100 100" class="pw-symbol">
          <circle cx="50" cy="50" r="28" fill="none" stroke="white" stroke-width="8" stroke-linecap="round"/>
          <line x1="50" y1="50" x2="50" y2="33" stroke="white" stroke-width="6" stroke-linecap="round"/>
          <line x1="50" y1="50" x2="64" y2="57" stroke="white" stroke-width="6" stroke-linecap="round"/>
          <circle cx="50" cy="50" r="3.5" fill="white"/>
          <g transform="translate(62,62)">
            <rect x="-12" y="-12" width="24" height="24" rx="6" fill="white"/>
            <path d="M -5 8 V -8 H 3.5
                     C 7 -8 10 -5.5 10 -2.2
                     C 10 1.0 7 3.5 3.5 3.5 H -1.5 V 8 Z
                     M -1.5 0 H 3.2
                     C 4.9 0 6.2 -1.2 6.2 -2.2
                     C 6.2 -3.3 4.9 -4.5 3.2 -4.5 H -1.5 V 0 Z"
                  fill="#1247C6"/>
          </g>
        </svg>
      </div>
      <h1 class="brand-name">ParkWecker</h1>
    </div>
    <div style="display:flex; gap:8px">
      <button class="icon-btn" id="btnTimer" title="Timer" aria-label="Timer">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#e5e7eb" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="13" r="8"/><path d="M12 9v4l3 2"/><path d="M9 2h6"/><path d="M19 4l-1.5 1.5"/>
        </svg>
      </button>
      <button class="icon-btn" id="btnHistory" title="Verlauf" aria-label="Verlauf">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#e5e7eb" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 12a9 9 0 1 0 3-6.7"/><path d="M3 3v6h6"/><path d="M12 7v5l3 3"/>
        </svg>
      </button>
      <button class="icon-btn" id="btnSettings" title="Einstellungen" aria-label="Einstellungen">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#e5e7eb" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 1 1 4.77 19l.06-.06a1.65 1.65 0 0 0 .33-1.82A1.65 1.65 0 0 0 3.65 15H3a2 2 0 1 1 0-4h.65A1.65 1.65 0 0 0 4.83 9 1.65 1.65 0 0 0 4.5 7.18L4.44 7.1A2 2 0 1 1 7.27 4.27l.06.06A1.65 1.65 0 0 0 9.15 4h.09A1.65 1.65 0 0 0 10.75 3V3a2 2 0 1 1 4 0v.06a1.65 1.65 0 0 0 1.51 1 1.65 1.65 0 0 0 1.82-.33l.06-.06A2 2 0 1 1 21 7.27l-.06.06A1.65 1.65 0 0 0 20 9.15v.09A1.65 1.65 0 0 0 21 10.75h.06A2 2 0 1 1 21 14h-.06a1.65 1.65 0 0 0-1.54 1z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- START – EINE große Box mit 3 Sektionen -->
  <section id="screenStart" class="screen active">
    <div class="card main-container">
      <!-- Sektion 1 -->
      <div class="section">
        <h2>Zeit wählen</h2>
        <div class="start-grid">
          <button class="btn primary start" data-min="15">15 Min</button>
          <button class="btn primary start" data-min="30">30 Min</button>
          <button class="btn primary start" data-min="60">1 Stunde</button>
        </div>
      </div>
      <div class="section-divider" aria-hidden="true"></div>

      <!-- Sektion 2 -->
      <div class="section">
        <h2>Timer manuell einstellen</h2>
        <div class="wheels">
          <div class="wheel" id="wheelH">
            <div class="viewport" id="vpH"></div>
          </div>
          <div class="wheel" id="wheelM">
            <div class="viewport" id="vpM"></div>
          </div>
        </div>
        <div style="height:8px"></div>
        <button class="btn primary small" id="btnManualStart">START</button>
      </div>
      <div class="section-divider" aria-hidden="true"></div>

      <!-- Sektion 3 -->
      <div class="section">
        <h2>Erinnerung vor Timer-Ende</h2>
        <div class="wheel single" id="wheelR">
          <div class="viewport" id="vpR"></div>
        </div>
        <p style="margin:8px 0 0; color:var(--muted); font-size:13px">Die Erinnerung wird automatisch vor Ablauf ausgelöst. Deine Auswahl wird gespeichert.</p>
      </div>
    </div>
  </section>

  <!-- TIMER -->
  <section id="screenTimer" class="screen">
    <div class="card timer-wrap">
      <div class="ring normalColor" id="ring">
        <div class="shadow-glow"></div>
        <svg viewBox="0 0 120 120">
          <defs><linearGradient id="gradStroke" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="var(--accent2)"/><stop offset="100%" stop-color="var(--accent1)"/></linearGradient></defs>
          <circle cx="60" cy="60" r="52" stroke="rgba(255,255,255,.1)" stroke-width="8" fill="none"/>
          <circle id="progress" cx="60" cy="60" r="52" stroke="url(#gradStroke)" stroke-width="8" stroke-linecap="round" stroke-dasharray="326.7256" stroke-dashoffset="0" fill="none" transform="rotate(-90 60 60)"/>
        </svg>
        <div class="time" id="timeBox"><div class="big" id="countdown">00:00:00</div></div>
      </div>

      <!-- Foto -->
      <div class="photo-wrap" id="photoWrap" aria-label="Parkplatz-Foto" style="display:none">
        <img id="photo" alt="Parkplatz-Foto"/>
        <video id="video" playsinline autoplay muted style="display:none"></video>
        <canvas id="canvas" style="display:none"></canvas>
        <div class="tap-overlay">Tippen, um ein neues Foto zu machen</div>
        <div style="position:absolute; bottom:10px; right:10px; display:flex; gap:8px;">
          <button id="btnTakePhoto" class="chip"><span id="camLabel">Kamera</span></button>
          <button id="btnRetake" class="chip" style="display:none">Neu</button>
          <button id="btnSkipPhoto" class="chip" style="display:none">Weiter ohne Foto</button>
          <input id="fileInput" type="file" accept="image/*" capture="environment" style="display:none">
        </div>
      </div>

      <!-- Standort & Share -->
      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:6px">
        <button class="btn flat small" id="btnShowMap" style="display:none">Standort anzeigen</button>
        <button class="btn flat small" id="btnShare" style="display:none">Teilen</button>
      </div>

      <!-- Quick actions -->
      <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-top:10px">
        <button class="btn warn small" id="btnPlus30">+ 30 min</button>
        <button class="btn warn small" id="btnPlus60">+ 1 h</button>
        <button class="btn danger small" id="btnStop">Stoppen</button>
      </div>
    </div>
  </section>

  <!-- HISTORY -->
  <section id="screenHistory" class="screen">
    <div class="card">
      <h3 style="margin:6px 0 10px">Verlauf (letzte 3)</h3>
      <div class="history" id="historyList"></div>
      <div class="pill" id="historyNone">Noch keine Einträge.</div>
    </div>
  </section>

  <!-- PROMPTS -->
  <div class="overlay" id="promptOverlay">
    <div class="modal" id="promptCard">
      <h3 id="promptTitle">Foto vom Parkplatz machen?</h3>
      <p id="promptText">Hilft dir, dein Auto schneller wiederzufinden.</p>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
        <button class="btn primary small" id="promptYes">Ja</button>
        <button class="btn flat small" id="promptNo">Nein</button>
      </div>
    </div>
  </div>

  <!-- END OVERLAY -->
  <div class="overlay" id="endOverlay">
    <div class="modal">
      <h3>Timer beendet</h3>
      <p>Bitte Parkschein verlängern oder Platz wechs
